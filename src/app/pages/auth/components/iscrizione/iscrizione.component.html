@if (caricaPersona) {
  <!-- Wizard Container -->
  @if (!(user.iscrizione.squadra && viewSuccespage)) {
    <div
      class="wizard-header d-flex justify-content-center align-items-center mb-4 p-3"
    >
      @for (step of wizard; track $index) {
        <div
          class="wizard-step text-center mx-3 position-relative"
          [class.active]="currentStep() === step.step"
        >
          <div
            class="circle mx-auto mb-1 d-flex justify-content-center align-items-center"
            [style]="{
              'background-color':
                currentStep() === step.step
                  ? 'var(--primary-color)'
                  : 'var(--border-color)',
              color:
                currentStep() === step.step
                  ? 'var(--surface-color)'
                  : 'var(--text-secondary)',
            }"
            style="
              width: 40px;
              height: 40px;
              border-radius: 50%;
              font-weight: bold;
            "
          >
            {{ step.step }}
          </div>
          <div
            class="label fw-semibold"
            [style]="{
              color:
                currentStep() === step.step
                  ? 'var(--primary-color)'
                  : 'var(--text-muted)',
            }"
          >
            {{ step.titolo }}
          </div>
          <!-- Linea di collegamento (se non ultimo step) -->
          @if ($index < wizard.length - 1) {
            <div
              class="position-absolute top-50 start-100 translate-middle-y"
              style="width: 50px; height: 2px"
            ></div>
          }
        </div>
      }
    </div>

    <!-- Step Content -->
    <div class="border-0 p-4" style="background-color: var(--surface-color)">
      @switch (currentStep()) {
        @case (1) {
          <app-step1 [team]="squadreInGame()"></app-step1>
        }
        @case (2) {
          @if (user.id) {
            <app-step2
              (formValido)="formValido = $event"
              [team]="team()"
            ></app-step2>
          } @else {
            <app-error-iscrizione></app-error-iscrizione>
          }
        }
        @case (3) {
          <app-step3
            [wizardData]="wizardService.getWizardForm()"
            (lineeGuidaEvent)="lineeGuidaAccettate = $event"
          ></app-step3>
        }
      }
    </div>

    <!-- Pulsanti -->
    @if (user.id || currentStep() != 2) {
      <div class="d-flex justify-content-between px-5 mt-3">
        <app-button-custom
          [text]="'Indietro'"
          [icon1]="'bi bi-arrow-left'"
          [color]="'var(--bg-lighter)'"
          (clickBotton)="prevStep()"
        ></app-button-custom>

        <app-button-custom
          [text]="currentStep() == 3 ? 'Invia' : 'Avanti'"
          [icon2]="'bi bi-arrow-right'"
          [color]="currentStep() == 3 ? '#20c997' : 'var(--primary-color)'"
          (clickBotton)="nextStep()"
          [disabled]="squadreInGame().length == 0"
        ></app-button-custom>
      </div>
    }
    <br />
  } @else {
    <app-success-page
      [user]="user!"
      [navigateToHome]="navigateToHome"
      (editInfo)="viewSuccespage = false"
    ></app-success-page>
  }
}
